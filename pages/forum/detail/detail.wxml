<!--pages/forum/detail/detail.wxml-->
<view class="container">
  <!-- 加载状态 -->
  <view class="loading" wx:if="{{isLoading}}">
    <text>加载中...</text>
  </view>

  <!-- 帖子详情 -->
  <view class="post-detail" wx:if="{{post}}">
    <view class="post-header">
      <view class="user-info">
        <image class="avatar" src="{{post.avatar_url}}" mode="aspectFill"></image>
        <view class="user-meta">
          <text class="nickname">{{post.nickname}}</text>
          <text class="time">{{post.created_at}}</text>
        </view>
      </view>
      
      <!-- 如果是帖子作者，显示管理按钮 -->
      <view class="manage" wx:if="{{isAuthor}}">
        <text class="manage-btn" bindtap="showManageOptions">•••</text>
      </view>
    </view>

    <view class="post-content">
      <text class="title">{{post.title}}</text>
      <text class="content">{{post.content}}</text>
      
      <!-- 图片列表 -->
      <view class="image-list" wx:if="{{post.images && post.images.length > 0}}">
        <image 
          wx:for="{{post.images}}" 
          wx:key="*this"
          src="{{item}}"
          mode="aspectFill"
          bindtap="previewImage"
          data-url="{{item}}"
        ></image>
      </view>
    </view>

    <view class="post-footer">
      <view class="action" bindtap="toggleLike">
        <text class="iconfont {{isLiked ? 'icon-like-filled' : 'icon-like'}}"></text>
        <text>{{post.like_count || 0}}</text>
      </view>
      <view class="action">
        <text class="iconfont icon-comment"></text>
        <text>{{post.comment_count || 0}}</text>
      </view>
    </view>
  </view>

  <!-- 评论列表 -->
  <view class="comment-list">
    <view class="comment-header">
      <text class="title">评论 {{post.comment_count || 0}}</text>
    </view>

    <view class="comment-items">
      <view 
        class="comment-item" 
        wx:for="{{comments}}" 
        wx:key="id"
      >
        <image class="avatar" src="{{item.avatar_url}}" mode="aspectFill"></image>
        <view class="comment-content">
          <view class="comment-meta">
            <text class="nickname">{{item.nickname}}</text>
            <text class="time">{{item.created_at}}</text>
          </view>
          <text class="text">{{item.content}}</text>
        </view>
      </view>

      <view class="no-comment" wx:if="{{comments.length === 0}}">
        暂无评论，快来抢沙发吧~
      </view>
    </view>
  </view>

  <!-- 评论输入框 -->
  <view class="comment-input">
    <input 
      class="input" 
      placeholder="写下你的评论..." 
      value="{{newComment}}"
      bindinput="onCommentInput"
      bindconfirm="submitComment"
    />
    <button 
      class="submit-btn" 
      bindtap="submitComment"
      disabled="{{!newComment.trim()}}"
    >发送</button>
  </view>
</view>