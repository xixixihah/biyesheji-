<!--index.wxml-->
<page-meta>
  <navigation-bar title="Weixin" back="{{false}}" color="black" background="#FFF"></navigation-bar>
</page-meta>

<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container" style="height: 1275rpx; display: flex; box-sizing: border-box">
    <!-- æœç´¢æ  -->
    <view class="search-box">
      <view class="location">
        <image class="location-icon" src="/images/location.png"></image>
        <text>{{currentLocation}}</text>
      </view>
      <view class="search-input">
        <image class="search-icon" src="/images/location.png"></image>
        <input 
          style="height: 27rpx; display: block; box-sizing: border-box" 
          placeholder="è¯·è¾“å…¥æƒ³è¦æŸ¥è¯¢çš„ä½ç½®" 
          value="{{searchText}}"
          bindtap="handleInputTap"
          bindinput="onSearchInput"
        />
        <view class="search-btn" bindtap="handleSearch">æœç´¢</view>
      </view>
    </view>

    <!-- åˆ†ç±»æ ‡ç­¾ -->
    <view class="category-tabs">
      <view class="tab {{activeTab === 'all' ? 'active' : ''}}" bindtap="switchTab" data-type="all">å…¨éƒ¨</view>
      <view class="tab {{activeTab === 'charging' ? 'active' : ''}}" bindtap="switchTab" data-type="charging" style="width: 122rpx; display: block; box-sizing: border-box">å……ç”µæ¡©</view>
      <view class="tab {{activeTab === 'swap' ? 'active' : ''}}" bindtap="switchTab" data-type="swap">æ¢ç”µæŸœ</view>
      <view class="tab {{activeTab === 'cabinet' ? 'active' : ''}}" bindtap="switchTab" data-type="cabinet">å……ç”µæŸœ</view>
    </view>

    <!-- åœ°å›¾ç»„ä»¶ -->
    <map
      id="myMap"
      class="map"
      latitude="{{latitude}}"
      longitude="{{longitude}}"
      markers="{{markers}}"
      polyline="{{polyline}}"
      show-location
      scale="{{scale}}"
      show-location="{{setting.showLocation}}"
      enable-zoom="{{setting.enableZoom}}"
      enable-scroll="{{setting.enableScroll}}"
      enable-rotate="{{setting.enableRotate}}"
      show-compass="{{setting.showCompass}}"
      enable-3D="{{setting.enable3D}}"
      enable-overlooking="{{setting.enableOverlooking}}"
      enable-satellite="{{setting.enableSatellite}}"
      enable-traffic="{{setting.enableTraffic}}"
      style="position: relative; left: 0rpx; top: -1rpx">
    </map>

    <view class="map-controls">
      <view class="control-btn route-btn" bindtap="showRoutePlanPanel">
        <image src="/images/route.png"></image>
        <text>è·¯çº¿</text>
      </view>
      <view class="control-btn plan-btn" bindtap="showRouteOnMap">
        <image src="/images/plan.png"></image>
        <text>è§„åˆ’</text>
      </view>
    </view>

    <view class="sun-effect {{showSunEffect ? 'active' : ''}}" wx:if="{{showSunEffect}}">
      <view class="sun"></view>
    </view>

    <view class="warning-text {{showWarningText ? 'active' : ''}}" wx:if="{{showWarningText}}">
      <view class="warning-content">
        <text class="emoji">âš ï¸</text>
        <text>çœ‹åˆ°å¤ªé˜³äº†ï¼Œæ³¨æ„é˜²æ™’ï¼</text>
        <text class="emoji">ğŸ•¶ï¸</text>
      </view>
    </view>

    <!-- è·¯çº¿è§„åˆ’é¢æ¿ -->
    <view class="route-plan {{showRoutePlan ? 'show' : ''}}">
      <!-- æ·»åŠ é¡¶éƒ¨æ ï¼ŒåŒ…å«è¿”å›æŒ‰é’®å’Œæ ‡é¢˜ -->
      <view class="route-header">
        <view class="header-bar">
          <view class="back-btn" bindtap="hideRoutePlanPanel">
            <image src="/images/back.png"></image>
          </view>
          <text class="header-title">è·¯çº¿è§„åˆ’</text>
        </view>

        <!-- ä¼˜åŒ–èµ·ç»ˆç‚¹è¾“å…¥åŒºåŸŸ -->
        <view class="location-inputs">
          <view class="location-line"></view>
          <view class="input-group">
            <view class="start-point">
              <image class="location-icon" src="/images/start.png"></image>
              <text class="location-text">{{startLocation.name || 'æˆ‘çš„ä½ç½®'}}</text>
            </view>
            <view class="end-point">
              <image class="location-icon" src="/images/end.png"></image>
              <view class="input-wrapper" bindtap="chooseDestination">
                <input 
                  placeholder="è¯·è¾“å…¥ç›®çš„åœ°" 
                  disabled="true"
                  value="{{endLocation.name}}"
                />
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- ä¼˜åŒ–äº¤é€šæ–¹å¼é€‰æ‹©åŒºåŸŸ -->
      <view class="transport-modes">
        <view 
          class="mode-item {{currentMode === item.id ? 'active' : ''}}"
          wx:for="{{transportModes}}"
          wx:key="id"
          bindtap="selectTransportMode"
          data-mode="{{item.id}}"
        >
          <image src="{{item.icon}}"></image>
          <text>{{item.name}}</text>
          <text class="mode-time" wx:if="{{routeInfo[item.id]}}">{{routeInfo[item.id].time}}</text>
        </view>
      </view>

      <!-- æ·»åŠ è·¯çº¿è¯¦æƒ…åŒºåŸŸ -->
      <scroll-view class="route-details" scroll-y wx:if="{{routeInfo}}">
        <view class="route-summary">
          <text class="route-time">é¢„è®¡{{routeInfo[currentMode].time}}åˆ†é’Ÿ</text>
          <text class="route-distance">{{routeInfo[currentMode].distance}}</text>
        </view>
        <view class="route-steps">
          <!-- è·¯çº¿æ­¥éª¤å°†åœ¨åç»­æ·»åŠ  -->
        </view>
      </scroll-view>

      <!-- ä¼˜åŒ–å¯¼èˆªæŒ‰é’® -->
      <view class="bottom-bar">
        <button class="start-nav-btn" bindtap="startNavigation">
          <image src="/images/navigate.png"></image>
          <text>å¼€å§‹å¯¼èˆª</text>
        </button>
      </view>
    </view>
  </view>
</scroll-view>
